{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/iamsogoodlo/market_sim/frontend/components/TradingChart.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState } from 'react';\n\ninterface TradingChartProps {\n  symbol: string;\n  height?: number;\n  showVolume?: boolean;\n  interval?: string;\n}\n\nexport default function TradingChart({ symbol, height = 400, showVolume = true, interval = '1D' }: TradingChartProps) {\n  const chartContainerRef = useRef<HTMLDivElement>(null);\n  const chartRef = useRef<any>(null);\n  const candlestickSeriesRef = useRef<any>(null);\n  const volumeSeriesRef = useRef<any>(null);\n  const [loading, setLoading] = useState(false);\n\n  // Initialize chart\n  useEffect(() => {\n    if (!chartContainerRef.current) return;\n\n    import('lightweight-charts').then(({ createChart }) => {\n      if (!chartContainerRef.current || chartRef.current) return;\n\n      const chart = createChart(chartContainerRef.current, {\n        layout: {\n          background: { color: 'transparent' },\n          textColor: '#D1D4DC',\n        },\n        grid: {\n          vertLines: { color: 'rgba(42, 46, 57, 0.4)' },\n          horzLines: { color: 'rgba(42, 46, 57, 0.4)' },\n        },\n        width: chartContainerRef.current.clientWidth,\n        height: height || chartContainerRef.current.clientHeight,\n        timeScale: {\n          timeVisible: true,\n          secondsVisible: false,\n          borderColor: '#363A45',\n        },\n        crosshair: {\n          mode: 1,\n          vertLine: {\n            color: '#758696',\n            width: 1,\n            style: 3,\n          },\n          horzLine: {\n            color: '#758696',\n            width: 1,\n            style: 3,\n          },\n        },\n        rightPriceScale: {\n          borderColor: '#363A45',\n          textColor: '#787B86',\n        },\n        leftPriceScale: {\n          visible: showVolume,\n          borderColor: '#363A45',\n          textColor: '#787B86',\n        },\n      });\n\n      chartRef.current = chart;\n\n      // Add candlestick series\n      const candlestickSeries = chart.addCandlestickSeries({\n        upColor: '#089981',\n        downColor: '#F23645',\n        borderVisible: false,\n        wickUpColor: '#089981',\n        wickDownColor: '#F23645',\n      });\n\n      candlestickSeriesRef.current = candlestickSeries;\n\n      // Add volume series if enabled\n      if (showVolume) {\n        const volumeSeries = chart.addHistogramSeries({\n          color: '#26a69a',\n          priceFormat: {\n            type: 'volume',\n          },\n          priceScaleId: 'left',\n        });\n\n        volumeSeriesRef.current = volumeSeries;\n      }\n\n      // Handle resize\n      const handleResize = () => {\n        if (chartContainerRef.current && chartRef.current) {\n          chartRef.current.applyOptions({\n            width: chartContainerRef.current.clientWidth,\n            height: height || chartContainerRef.current.clientHeight,\n          });\n        }\n      };\n\n      window.addEventListener('resize', handleResize);\n\n      // Load initial data\n      fetchChartData(symbol, interval);\n\n      return () => {\n        window.removeEventListener('resize', handleResize);\n        if (chartRef.current) {\n          chartRef.current.remove();\n          chartRef.current = null;\n        }\n      };\n    }).catch(error => {\n      console.error('Error loading chart library:', error);\n    });\n\n    return () => {\n      if (chartRef.current) {\n        chartRef.current.remove();\n        chartRef.current = null;\n      }\n    };\n  }, [height, showVolume]);\n\n  // Fetch and update chart data when symbol or interval changes\n  useEffect(() => {\n    if (!symbol || !chartRef.current) return;\n    fetchChartData(symbol, interval);\n  }, [symbol, interval]);\n\n  const fetchChartData = async (sym: string, int: string) => {\n    if (!candlestickSeriesRef.current) return;\n\n    setLoading(true);\n    try {\n      // Map interval to API format\n      const intervalMap: Record<string, string> = {\n        '1M': '1m',\n        '5M': '5m',\n        '15M': '15m',\n        '1H': '1h',\n        '1D': '1d',\n        '1W': '1d'\n      };\n\n      const apiInterval = intervalMap[int] || '1d';\n      const period = int === '1D' ? '1y' : int === '1W' ? '2y' : int === '1H' ? '1mo' : '5d';\n\n      const response = await fetch(`/api/stocks/historical/${sym}/${period}?interval=${apiInterval}`);\n\n      if (!response.ok) {\n        console.error('Failed to fetch chart data');\n        return;\n      }\n\n      const data = await response.json();\n\n      if (!data || data.length === 0) {\n        console.error('No data received');\n        return;\n      }\n\n      // Transform data to Lightweight Charts format\n      const candlestickData = data.map((bar: any) => ({\n        time: (new Date(bar.date).getTime() / 1000) as any,\n        open: bar.open,\n        high: bar.high,\n        low: bar.low,\n        close: bar.close,\n      }));\n\n      const volumeData = data.map((bar: any) => ({\n        time: (new Date(bar.date).getTime() / 1000) as any,\n        value: bar.volume,\n        color: bar.close >= bar.open ? 'rgba(8, 153, 129, 0.5)' : 'rgba(242, 54, 69, 0.5)',\n      }));\n\n      // Update series\n      if (candlestickSeriesRef.current) {\n        candlestickSeriesRef.current.setData(candlestickData);\n      }\n\n      if (volumeSeriesRef.current && showVolume) {\n        volumeSeriesRef.current.setData(volumeData);\n      }\n\n      // Fit content\n      if (chartRef.current) {\n        chartRef.current.timeScale().fitContent();\n      }\n\n    } catch (error) {\n      console.error('Error fetching chart data:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"w-full h-full relative\" ref={chartContainerRef}>\n      {loading && (\n        <div className=\"absolute top-4 right-4 text-xs text-muted-foreground\">\n          Loading...\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}